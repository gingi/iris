<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">define([&quot;util/dropdown&quot;], function (DropDown) {
    function DropDowns(dataAPI) {
        var self = this;
        var dropdowns, dropDownFactory;
        var breadcrumbs;
        
        dropdowns = {
            genome: {
                name:       &quot;Genomes&quot;,
                url:        dataAPI(&quot;/genome&quot;),
                listeners:  ['experiment'],
                listParse:  function (response) {
                    return response.result;
                },
                parseItem: function (data, item) {
                    item.id    = data[0];
                    item.title = data[1];
                    item.trait = data[2] == 1;
                },
                fetchData: { haveTrait: 1 },
            },     
            experiment: {
                name: &quot;Experiments&quot;,
                url:  function () {
                    return dataAPI(&quot;/genome/&quot; + this.parentId + &quot;/experiments&quot;)
                },
                listeners:  ['trait'],
                parent: 'genome',
                idAttribute: 'genome',
                array: 'experiments',
                listParse: function (data) {
                    this.parentId = data.genome;
                    return data;
                }
            },
            trait: {
                name: &quot;Traits&quot;,
                url: function () {
                    return dataAPI(&quot;/experiment/&quot; + this.parentId + &quot;/traits&quot;);
                },
                parent: 'experiment',
                idAttribute: 'experiment',
                array: 'traits'
            }
        };

        dropDownFactory = new DropDown({
            container: &quot;#nav-content&quot;,
            sortBy: function (item) { return item.title.toLowerCase(); },
            itemLink: function (item) {
                return &quot;#&quot; + item.type + &quot;/&quot; + item.id;
            }
        });
        
        dropdowns.genome.factory = new DropDown({
            container: &quot;#nav-content&quot;,
            sortBy: function (item) {
                return item.trait ? &quot;0&quot; : &quot;1&quot; + item.title.toLowerCase();
            },
            itemLink: function (item) {
                return item.trait ? &quot;#&quot; + item.type + &quot;/&quot; + item.id : null;
            },
            itemTemplate: JQ(&quot;&lt;script&gt;&quot;).attr(&quot;type&quot;, &quot;text/template&quot;).html(
                '&lt;a href=&quot;&lt;%= link %&gt;&quot;&gt;&lt;%= title %&gt;&lt;/a&gt;'
            )
        });

        function breadcrumb(type) {
            return JQ(&quot;&lt;li&gt;&quot;)
                .append(JQ(&quot;&lt;a&gt;&quot;, { id: &quot;breadcrumb-&quot; + type }))
                .append(JQ(&quot;&lt;span&gt;&quot;).addClass(&quot;divider&quot;).text(&quot;/&quot;));
        }
        
        function init() {
            breadcrumbs = JQ(&quot;&lt;ul&gt;&quot;, {
                id: &quot;dropdown-breadcrumbs&quot;
            }).addClass(&quot;breadcrumb&quot;).css(&quot;display&quot;, &quot;none&quot;);
            JQ(&quot;#datavis&quot;).before(breadcrumbs);
            
            for (var type in dropdowns) {
                var dd = dropdowns[type];
                var select;
                var factory = dd.factory || dropDownFactory;
                dd.view = factory.create(_.extend({
                    itemType:   type,
                    copyTarget: &quot;#breadcrumb-&quot; + type
                }, dd));
                breadcrumbs.append(breadcrumb(type));
            }
            JQ(&quot;li:last-child&quot;, breadcrumbs).children(&quot;.divider&quot;).remove();
            dropdowns.genome.view.fetch();
        }
        
        self.listen = function (type, id) {
            if (dropdowns[type].listeners == null) return;
            dropdowns[type].listeners.forEach(function (l) {
                setCollection = false;
                dropdowns[l].view.fetch({
                    data: { parentId: id },
                    success: function (collection, response) {
                        if (!setCollection) {
                            self.update(
                                type, id, response[dropdowns[type].parent]);
                            setCollection = true;
                        }
                    }
                });
            });
        };
        self.update = function (type, id, parentId) {
            var dd = dropdowns[type];
            if (dd.view.collection.length == 0) {
                dd.view.fetch({
                    data: { parentId: parentId },
                    success: function (collection, response) {
                        if (!dd.parent) return;
                        var parent = dropdowns[dd.parent];
                        self.update(
                            dd.parent,
                            response[dd.parent],
                            response[parent.idAttribute]
                        );
                        dd.view.select(id);
                    }
                });
            } else {
                dd.view.select(id);
            }
        };
    
        self.select = function (type, id) {
            breadcrumbs.show();
            dropdowns[type].view.select(id);
        };
        
        init();
        return self;
    }
    
    return DropDowns;
});</pre>
</body>
</html>
