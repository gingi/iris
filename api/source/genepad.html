<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">define(['jquery', 'underscore', 'backbone', 'util/progress'],
function (JQ, _, Backbone, Progress) {
    var Gene = Backbone.Model.extend({
        urlTemplate: _.template(&quot;/data/feature/&lt;%= name %&gt;&quot;),
        url: function () {
            return this.urlTemplate(this.toJSON());
        },
        defaults: {
            name: &quot;&quot;
        }
    });
    var GeneList = Backbone.Collection.extend({
        model: Gene,
    });
    
    function popoverContent() {
        return JQ(&quot;&lt;div&gt;&quot;).css(&quot;padding&quot;, &quot;8px&quot;)
            .append(JQ(&quot;&lt;textarea&gt;&quot;, {
                id: &quot;textarea-genepad&quot;,
                placeholder: &quot;List of genes&quot;,
                rows: 3
            }))
            .append(JQ(&quot;&lt;div&gt;&quot;).css(&quot;display&quot;, &quot;inline-block&quot;)
                .css(&quot;padding-top&quot;, 8)
                .append(JQ(&quot;&lt;button&gt;&quot;, { id: &quot;btn-genepad-upload&quot; })
                    .addClass(&quot;btn btn-primary btn-mini&quot;)
                    .html(&quot;&lt;i class=\&quot;icon-upload-alt\&quot;&gt;&lt;/i&gt;&quot;)))
            .append(JQ(&quot;&lt;div&gt;&quot;, { id: &quot;genepad-progress&quot;})
                .css(&quot;width&quot;, &quot;160px&quot;)
                .addClass(&quot;progress-indicator&quot;))
    }
    
    var GenePad = Backbone.View.extend({
        collection: new GeneList,
        el: &quot;#nav-content&quot;,
        events: {
            &quot;click #btn-genepad-upload&quot;: &quot;startPad&quot;
        },
        initialize: function (options) {
            options = options ? _.clone(options) : {};
            this.render();
        },
        render: function () {
            var li = JQ(&quot;&lt;li&gt;&quot;)
                .append(JQ(&quot;&lt;a&gt;&quot;).text(&quot;Gene Pad&quot;));
            this.$el.append(li);
            this.popoverContent = popoverContent();
            li.popover({
                content: this.popoverContent,
                placement: &quot;bottom&quot;,
                html: true
            });
        },
        upload: function (genes) {
            var progress = new Progress({
                type: Progress.BAR,
                element: JQ(&quot;#genepad-progress&quot;)
            });
            progress.progress(&quot;5%&quot;)
            progress.show();
            var collection = this.collection;
            collection.reset(
                _.map(_.compact(genes), function (name) { return { name: name }
            }));
            var fetched = 1;
            var deferred = JQ.Deferred(), chained = deferred;
            collection.each(function (model) {
                chained = chained.then(function () {
                    var promise = JQ.Deferred();
                    model.fetch({ success: function () {
                        fetched++
                        progress.progress(fetched /
                            genes.length * 100 + &quot;%&quot;);
                        promise.resolve();
                    }});
                    return promise;
                });
            });
            chained.done(function () {
                collection.trigger(&quot;fetch&quot;);
                progress.dismiss();
            });
            deferred.resolve();
        },
        startPad: function () {
            var genestr =
                JQ(&quot;#textarea-genepad&quot;).val()
                    .replace(/[^\w\s\|\.\-\@]/g, '')
                    .replace(/^\s+|\s+JQ/, '')
                    .replace(/,\s*|\s+/g, ',');
            this.router.navigate(&quot;#genepad/&quot; + genestr, true);
        },
        setGenes: function (genestr) {
            this.genesInput = genestr.split(&quot;,&quot;);
            this.updateTextarea();
            this.upload(this.genesInput);
        },
        updateTextarea: function () {
            this.popoverContent.find(&quot;#textarea-genepad&quot;)
                .val(this.genesInput.join(&quot;\n&quot;));
        },
        setRouter: function (router) {
            this.router = router;
        }
    });
	return GenePad;
})
</pre>
</body>
</html>
