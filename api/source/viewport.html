<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">define([
    &quot;jquery&quot;,
    &quot;underscore&quot;,
    &quot;util/progress&quot;,
    &quot;util/syntax&quot;,
    &quot;util/modal&quot;,
    &quot;jquery-ui&quot;
], function (JQ, _, Progress, Syntax, Modal) {
    var viewportCounter = 1;
    var defaults = {
        height: 400,
        parent: &quot;body&quot;,
        title: &quot;Viewport&quot;,
        toolbox: true,
        maximize: true,
        resizable: false,
        toolboxHides: false,
        sortContainer: null
    };
    var MaximizeModal = new Modal({
        backdrop: true,
        height: JQ(&quot;body&quot;).height() - 100,
        width: JQ(&quot;body&quot;).width() - 100
    });
    MaximizeModal.init();
    var ExportModal = new Modal({
        title: &quot;Data Export&quot;,
        contentId: &quot;export-content&quot;
    });
    ExportModal.footer(
        JQ(&quot;&lt;a&gt;&quot;, { href: &quot;#&quot;, download: &quot;export.json&quot; })
            .addClass(&quot;btn btn-primary&quot;)
            .append(JQ(&quot;&lt;i&gt;&quot;).addClass(&quot;icon-download-alt&quot;))
            .append(&quot; Download&quot;).click(function (e) {
                e.preventDefault();
                var uriContent =
                    &quot;data:application/json,&quot; +
                    encodeURIComponent(JQ(&quot;#export-content&quot;).text());
                window.open(uriContent, &quot;export.json&quot;);
                return false;
            }
        )
    );
    ExportModal.init();
    JQ(&quot;.viewport&quot;)
        .attr('unselectable', 'on')
        .css('user-select', 'none')
        .on('selectstart', false);

<span id='Viewport-method-constructor'><span id='Viewport'>    /**
</span></span>     * @constructor
     * 
     * @param {String|Number} id
     * @param {String|Object} parent
     * @param {String} title
     * @param {String} classes
     * @param {String|Number} height
     * @param {String|Number} width
     */
    function Viewport(options) {
        var self = this;
        options = options ? _.clone(options) : {};
        options.parent = JQ(options.parent);
        if (!options.height &amp;&amp; options.parent.height() &gt; 0)
            options.height = options.parent.height();
        _.defaults(options, defaults);
        options.id = options.id || [&quot;viewport&quot;, viewportCounter].join(&quot;-&quot;);
        viewportCounter++;
        
        var div = JQ(&quot;&lt;div&gt;&quot;)
            .addClass(&quot;viewport&quot;)
            .attr(&quot;data-title&quot;, options.title)
            .attr(&quot;id&quot;, options.id + &quot;-wrapper&quot;)
            .css(&quot;min-height&quot;, options.height)
            .css(&quot;min-width&quot;, options.width);
        if (options.classes) { div.addClass(options.classes); }
        var content = JQ(&quot;&lt;div&gt;&quot;)
            .addClass(&quot;viewport-content&quot;)
            .attr(&quot;id&quot;, options.id);
        content.progress = new Progress({ element: content });
        options.parent.append(div);
        div.append(content);
        content
            .css(&quot;min-height&quot;, div.height())
            .css(&quot;min-width&quot;, div.width());
        div.css(&quot;width&quot;, &quot;99%&quot;);
        div.css(&quot;height&quot;, &quot;99%&quot;);

        if (options.toolbox) {
            self.toolbox = createToolbox(options);
            div.append(self.toolbox);
            if (options.toolboxHides) {
                self.toolbox.hide();
                div.on(&quot;mouseenter&quot;, function (e) {
                    e.preventDefault();
                    if (self.toolbox._isShown) return;
                    self.toolbox._isShown = true;
                    self.toolbox.show('fast');
                }).on(&quot;mouseleave&quot;, function (e) {
                    e.preventDefault();
                    self.toolbox._isShown = false;
                    self.toolbox.hide('fast');
                }).on(&quot;click&quot;, function (e) {
                    JQ(this).find(&quot;.dropdown-menu&quot;).toggle();
                    e.stopPropagation();
                });
            }
            if (options.sortContainer !== null) {
                var target = JQ(options.sortContainer);
                target.sortable({
                    containment: target,
                    handle: &quot;.drag-button&quot;,
                    cancel: &quot;&quot;,
                    tolerance: &quot;pointer&quot;,
                    helper: &quot;clone&quot;
                });
                target.disableSelection();
            }
        }
        content.showError = function (params) {
            params = params ? _.clone(params) : {};
            params.message = params.message || &quot;Viewport error&quot;;
            content.empty();
            content.append(JQ(&quot;&lt;div&gt;&quot;).addClass(&quot;alert alert-error&quot;)
                .append(JQ(&quot;&lt;h3&gt;&quot;).text(&quot;Error&quot;))
                .append(JQ(&quot;&lt;span&gt;&quot;).html(params.message)));
        };
        content.addTool = function (tool) {
            return self.toolbox.find(&quot;#viewport-toolbox&quot;).append(
                JQ(&quot;&lt;li&gt;&quot;).append(tool)
            );
        };
        content.renderer = function (r) {
            self.renderer = r;
        };
        content.toolbox = function () {
            return self.toolbox;
        };        
        return content;
        
        function createToolbox(options) {
            var div = JQ(&quot;&lt;div&gt;&quot;)
                .addClass(&quot;viewport-toolbox btn-group btn-group-sm&quot;);
            div.append(JQ(&quot;&lt;div&gt;&quot;).addClass(&quot;btn-group btn-group-sm&quot;)
                .append(JQ(&quot;&lt;a&gt;&quot;, { href: &quot;#&quot;, &quot;data-toggle&quot;: &quot;dropdown&quot; })
                    .addClass(&quot;btn btn-default&quot;)
                    .html(JQ(&quot;&lt;i&gt;&quot;, { class: &quot;icon icon-cog&quot; }))
                    .dropdown()
                ).append(JQ(&quot;&lt;ul&gt;&quot;, {
                    id: &quot;viewport-toolbox&quot;,
                    class: &quot;dropdown-menu&quot;
                }).append(JQ(&quot;&lt;li&gt;&quot;)
                    .append(JQ(&quot;&lt;a&gt;&quot;, { href: &quot;#&quot; + window.location.hash })
                        .html(JQ(&quot;&lt;i&gt;&quot;, { class: &quot;icon icon-download-alt&quot; })
                            .append(&quot; Export data&quot;)))
                    .click(function (event) {
                        event.preventDefault();
                        if (self.renderer === null) { return; }
                        var exportData = Syntax(self.renderer.getData());
                        JQ(&quot;#export-content&quot;).empty().append(JQ(&quot;&lt;pre&gt;&quot;)
                            .html(exportData)
                        );
                        ExportModal.show();
                        return false;
                    }))
                )
            );
            if (options.maximize) {
                div.append(JQ(&quot;&lt;div&gt;&quot;, { id: &quot;btn-maximize&quot; })
                    .addClass(&quot;btn btn-default&quot;)
                    .html(JQ(&quot;&lt;i&gt;&quot;, { class: &quot;icon-resize-full&quot; }))
                    .click(toggleMaximize));
            }
            if (options.sortContainer !== null) {
                div.append(JQ(&quot;&lt;div&gt;&quot;)
                    .addClass(&quot;btn btn-default drag-button&quot;)
                    .html(JQ(&quot;&lt;i&gt;&quot;, { class: &quot;icon-move&quot; })));
            }
            return div;
        }
        function toggleMaximize() {
            MaximizeModal.toggle();
            function minimize () {
                div.outerHeight(options.parent.height() - 10);
                div.outerWidth(options.parent.width()   - 10);
                options.parent.append(div);
                MaximizeModal.emptyBody();
                MaximizeModal.shown = false;
                self.toolbox.find(&quot;#btn-maximize&quot;).find(&quot;i&quot;)
                    .removeClass().addClass(&quot;icon-resize-full&quot;);
            }
            if (MaximizeModal.shown) {
                minimize();
            } else {
                div.height(MaximizeModal.body().height() - 42);
                MaximizeModal.body(div);
                MaximizeModal.shown = true;
                MaximizeModal.on(&quot;hidden&quot;, minimize);
                self.toolbox.find(&quot;#btn-maximize&quot;).find(&quot;i&quot;)
                    .removeClass().addClass(&quot;icon-resize-small&quot;);
            }
            if (self.renderer) {
                setTimeout(function () {
                    content.outerHeight(div.height());
                    content.outerWidth(div.width());
                    self.renderer.render();
                }, 1000);
            }
        }
    }
    return Viewport;
});</pre>
</body>
</html>
