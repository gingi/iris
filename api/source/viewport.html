<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">define([
    &quot;jquery&quot;,
    &quot;underscore&quot;,
    &quot;util/progress&quot;,
    &quot;util/syntax&quot;,
    &quot;util/modal&quot;,
    &quot;iris&quot;
], function (JQ, _, Progress, Syntax, Modal, Iris) {
    var viewportCounter = 1;
    var defaults = {
        height: 400,
        parent: &quot;body&quot;,
        title: &quot;Viewport&quot;,
        toolbox: true,
        maximize: true,
        resizable: false,
        toolboxHides: false,
        sortContainer: null
    };
    var MaximizeModal = new Modal({
        backdrop: true,
        height: JQ(document).height() - 100,
        width:  JQ(document).width()  - 100
    });
    MaximizeModal.init();
    var ExportModal = new Modal({
        title: &quot;Data Export&quot;,
        contentId: &quot;export-content&quot;
    });
    ExportModal.footer(
        JQ(&quot;&lt;a&gt;&quot;, { href: &quot;#&quot;, download: &quot;export.json&quot; })
            .addClass(&quot;btn btn-primary&quot;)
            .append(JQ(&quot;&lt;i&gt;&quot;).addClass(&quot;fa fa-download-alt&quot;))
            .append(&quot; Download&quot;).click(function (e) {
                e.preventDefault();
                var uriContent =
                    &quot;data:application/json,&quot; +
                    encodeURIComponent(JQ(&quot;#export-content&quot;).text());
                window.open(uriContent, &quot;export.json&quot;);
                return false;
            }
        )
    );
    ExportModal.init();
    JQ(&quot;.viewport&quot;)
        .attr(&#39;unselectable&#39;, &#39;on&#39;)
        .css(&#39;user-select&#39;, &#39;none&#39;)
        .on(&#39;selectstart&#39;, false);

<span id='Viewport-method-constructor'><span id='Viewport'>    /**
</span></span>     * @class Viewport
     * A visual container for graphic elements. Includes a configurable toolbox
     * with various default functions, like maximization.
     * 
     * @constructor
     * 
     * @param {String|Number} id
     * @param {String|Object} parent
     * @param {String} title
     * @param {String} classes
     * @param {String|Number} height
     * @param {String|Number} width
     */
    function Viewport(options) {
        var self = this;
        options = options ? _.clone(options) : {};
        options.parent = JQ(options.parent);
        _.defaults(options, defaults);
        options.id = options.id || [&quot;viewport&quot;, viewportCounter].join(&quot;-&quot;);
        viewportCounter++;
        
        var $viewport = JQ(&quot;&lt;div&gt;&quot;)
            .addClass(&quot;viewport&quot;)
            .attr(&quot;data-title&quot;, options.title)
            .attr(&quot;id&quot;, options.id + &quot;-wrapper&quot;)
            .css(&quot;min-height&quot;, options.height)
            .css(&quot;min-width&quot;, options.width);
        if (options.classes !== undefined) {
            $viewport.addClass(options.classes);
        }
        var content = JQ(&quot;&lt;div&gt;&quot;)
            .addClass(&quot;viewport-content&quot;)
            .attr(&quot;id&quot;, options.id);
        content.progress = new Progress({ element: content });
        options.parent.append($viewport);
        $viewport.append(content);
        content
            .css(&quot;min-height&quot;, $viewport.height())
            .css(&quot;min-width&quot;, $viewport.width());
        $viewport.css(&quot;width&quot;, &quot;99%&quot;);
        $viewport.css(&quot;height&quot;, &quot;99%&quot;);

        if (options.toolbox) {
            self.toolbox = createToolbox(options);
            $viewport.append(self.toolbox);
            if (options.toolboxHides) {
                self.toolbox.hide();
                $viewport.on(&quot;mouseenter&quot;, function (e) {
                    e.preventDefault();
                    if (self.toolbox._isShown) return;
                    self.toolbox._isShown = true;
                    self.toolbox.show(&#39;fast&#39;);
                }).on(&quot;mouseleave&quot;, function (e) {
                    e.preventDefault();
                    self.toolbox._isShown = false;
                    self.toolbox.hide(&#39;fast&#39;);
                }).on(&quot;click&quot;, function (e) {
                    JQ(this).find(&quot;.dropdown-menu&quot;).toggle();
                    e.stopPropagation();
                });
            }
            if (options.sortContainer !== null) {
                var target = JQ(options.sortContainer);
                // target.sortable({
                //     containment: target,
                //     handle: &quot;.drag-button&quot;,
                //     cancel: &quot;&quot;,
                //     tolerance: &quot;pointer&quot;,
                //     helper: &quot;clone&quot;
                // });
                // target.disableSelection();
            }
        }
        content.showError = function (params) {
            params = params ? _.clone(params) : {};
            params.message = params.message || &quot;Viewport error&quot;;
            content.empty();
            content.append(JQ(&quot;&lt;div&gt;&quot;).addClass(&quot;alert alert-error&quot;)
                .append(JQ(&quot;&lt;h3&gt;&quot;).text(&quot;Error&quot;))
                .append(JQ(&quot;&lt;span&gt;&quot;).html(params.message)));
        };
        content.addTool = function (tool) {
            return self.toolbox.find(&quot;#viewport-toolbox&quot;).append(
                JQ(&quot;&lt;li&gt;&quot;).append(tool)
            );
        };
        content.renderer = function (r) {
            if (r !== undefined) {
                self.renderer = r;
            }
            return self.renderer;
        };
        content.toolbox = function () {
            return self.toolbox;
        };
        var viewportState;
        MaximizeModal.on(&quot;shown.bs.modal&quot;, function () {
            var placeholder = JQ(&quot;&lt;div&gt;&quot;, { style: &quot;display:none&quot;});
            $viewport.before(placeholder);
            viewportState = {
                placeholder: placeholder,
                height:      $viewport.height(),
                width:       $viewport.width()
            };
            $viewport.height(MaximizeModal.body().height() - 42);
            MaximizeModal.body($viewport);
            self.toolbox.find(&quot;#btn-maximize&quot;).find(&quot;i&quot;)
                .removeClass().addClass(&quot;fa fa-expand&quot;);
            resetRendererBounds();
        });
        MaximizeModal.on(&quot;hidden.bs.modal&quot;, function () {
            $viewport.width(viewportState.width);
            $viewport.height(viewportState.height);
            viewportState.placeholder.before($viewport);
            viewportState.placeholder.remove();
            MaximizeModal.emptyBody();
            self.toolbox.find(&quot;#btn-maximize&quot;).find(&quot;i&quot;)
                .removeClass().addClass(&quot;fa fa-expand&quot;);
            resetRendererBounds();
        });
        
        function createToolbox(options) {
            var $toolbox = JQ(&quot;&lt;div&gt;&quot;)
                .addClass(&quot;viewport-toolbox btn-group btn-group-sm&quot;);
            $toolbox.append(JQ(&quot;&lt;div&gt;&quot;).addClass(&quot;btn-group btn-group-sm&quot;)
                .append(JQ(&quot;&lt;a&gt;&quot;, { href: &quot;#&quot;, &quot;data-toggle&quot;: &quot;dropdown&quot; })
                    .addClass(&quot;btn btn-default&quot;)
                    .html(JQ(&quot;&lt;i&gt;&quot;, { class: &quot;fa fa-cog&quot; }))
                    .dropdown()
                ).append(JQ(&quot;&lt;ul&gt;&quot;, {
                    id: &quot;viewport-toolbox&quot;,
                    class: &quot;dropdown-menu&quot;
                }).append(JQ(&quot;&lt;li&gt;&quot;)
                    .append(JQ(&quot;&lt;a&gt;&quot;, { href: &quot;#&quot; + window.location.hash })
                        .html(JQ(&quot;&lt;i&gt;&quot;, { class: &quot;fa fa-download&quot; })
                            .append(&quot; Export data&quot;)))
                    .click(function (event) {
                        event.preventDefault();
                        if (self.renderer === null) { return; }
                        var exportData = Syntax(self.renderer.getData());
                        JQ(&quot;#export-content&quot;).empty().append(JQ(&quot;&lt;pre&gt;&quot;)
                            .html(exportData)
                        );
                        ExportModal.show();
                        return false;
                    }))
                )
            );
            if (options.maximize) {
                $toolbox.append(JQ(&quot;&lt;div&gt;&quot;, { id: &quot;btn-maximize&quot; })
                    .addClass(&quot;btn btn-default&quot;)
                    .html(JQ(&quot;&lt;i&gt;&quot;, { class: &quot;fa fa-expand&quot; }))
                    .click(function () {
                        MaximizeModal.toggle();
                    }));
            }
            if (options.sortContainer !== null) {
                $toolbox.append(JQ(&quot;&lt;div&gt;&quot;)
                    .addClass(&quot;btn btn-default drag-button&quot;)
                    .html(JQ(&quot;&lt;i&gt;&quot;, { class: &quot;fa fa-arrows&quot; })));
            }
            return $toolbox;
        }
        function resetRendererBounds() {
            if (self.renderer) {
                content.outerHeight($viewport.height());
                content.outerWidth($viewport.width());
                self.renderer.render();
            }
        }
        return content;
    }
    return Viewport;
});</pre>
</body>
</html>
